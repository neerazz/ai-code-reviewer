name: Deploy Documentation to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Pages
        uses: actions/configure-pages@v3

      - name: Create documentation site
        run: |
          mkdir -p _site
          cp README.md _site/index.md
          cp DEMO.md _site/demo.md
          cp CONTRIBUTING.md _site/contributing.md
          cp docs/*.md _site/ 2>/dev/null || true

          # Create index.html
          cat > _site/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>AI Code Reviewer - Documentation</title>
              <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
              <style>
                  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
                  .markdown-body { max-width: 900px; margin: 0 auto; padding: 2rem; }
              </style>
          </head>
          <body class="bg-gray-50">
              <nav class="bg-gray-900 text-white p-4">
                  <div class="container mx-auto">
                      <h1 class="text-2xl font-bold">AI Code Reviewer Documentation</h1>
                  </div>
              </nav>
              <div class="container mx-auto p-8">
                  <div class="grid md:grid-cols-4 gap-6">
                      <div class="md:col-span-1 bg-white p-6 rounded-lg shadow">
                          <h2 class="font-bold mb-4">Navigation</h2>
                          <ul class="space-y-2">
                              <li><a href="#overview" class="text-blue-600 hover:underline">Overview</a></li>
                              <li><a href="#getting-started" class="text-blue-600 hover:underline">Getting Started</a></li>
                              <li><a href="#demo.html" class="text-blue-600 hover:underline">Live Demo</a></li>
                              <li><a href="#api-docs" class="text-blue-600 hover:underline">API Documentation</a></li>
                              <li><a href="#contributing.html" class="text-blue-600 hover:underline">Contributing</a></li>
                              <li><a href="https://github.com/neerazz/ai-code-reviewer" class="text-blue-600 hover:underline">GitHub</a></li>
                          </ul>
                      </div>
                      <div class="md:col-span-3 bg-white p-6 rounded-lg shadow markdown-body">
                          <h1 id="overview">AI Code Reviewer</h1>
                          <p class="text-lg text-gray-600 mb-4">
                              An intelligent code review system that uses AI and static analysis to provide comprehensive code reviews,
                              detect security vulnerabilities, and suggest optimizations.
                          </p>

                          <h2 id="getting-started" class="mt-8 mb-4">Quick Start</h2>
                          <div class="bg-gray-100 p-4 rounded mb-4">
                              <pre class="overflow-x-auto"><code>git clone https://github.com/neerazz/ai-code-reviewer.git
          cd ai-code-reviewer
          docker-compose up -d</code></pre>
                          </div>
                          <p>Access at <a href="http://localhost:3000" class="text-blue-600 hover:underline">http://localhost:3000</a></p>

                          <h2 class="mt-8 mb-4">Features</h2>
                          <ul class="list-disc list-inside space-y-2">
                              <li>Multi-language support (Python, JavaScript, TypeScript, Java, Go, Rust, etc.)</li>
                              <li>AI-powered code analysis</li>
                              <li>Security vulnerability detection</li>
                              <li>Code quality metrics</li>
                              <li>Smart suggestions</li>
                          </ul>

                          <h2 class="mt-8 mb-4" id="api-docs">API Documentation</h2>
                          <p>Interactive API documentation available at:</p>
                          <ul class="list-disc list-inside">
                              <li><a href="http://localhost:8000/docs" class="text-blue-600 hover:underline">Swagger UI</a></li>
                              <li><a href="http://localhost:8000/redoc" class="text-blue-600 hover:underline">ReDoc</a></li>
                          </ul>

                          <div class="mt-8 p-4 bg-blue-50 border-l-4 border-blue-500 rounded">
                              <p class="font-bold">Need Help?</p>
                              <p>Check out our <a href="demo.html" class="text-blue-600 hover:underline">live demo</a> or
                              <a href="contributing.html" class="text-blue-600 hover:underline">contribution guidelines</a>.</p>
                          </div>
                      </div>
                  </div>
              </div>
          </body>
          </html>
          EOF

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
